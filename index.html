<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programma Giornaliero Lavorazione Frutta - Simone Gatto</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .header-programma {
            background: linear-gradient(135deg, #2E8B57, #228B22);
            color: white;
            padding: 25px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-weight: 600;
        }

        .section-body {
            padding: 20px;
        }

        .fornitore-container {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 20px;
            background: #fafafa;
        }

        .fornitore-header {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 12px 15px;
            margin: 0;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fornitore-body {
            padding: 15px;
        }

        .rese-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .rese-header {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dee2e6;
        }

        .input-group-custom {
            margin-bottom: 15px;
        }

        .input-group-custom .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }

        .btn-programma {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-programma:hover {
            background: linear-gradient(135deg, #20c997, #28a745);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .btn-remove {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .btn-remove:hover {
            background: linear-gradient(135deg, #c82333, #dc3545);
            color: white;
        }

        .bio-highlight {
            background-color: #ffe4e6 !important;
            border-color: #ffc0cb !important;
        }

        .bio-text {
            color: #dc3545;
            font-weight: bold;
        }

        .summary-table {
            margin-top: 20px;
        }

        .summary-table th {
            background-color: #e9ecef;
            font-weight: 600;
            border-top: none;
        }

        @media (max-width: 768px) {
            .fornitore-header {
                flex-direction: column;
                align-items: start;
                gap: 10px;
            }
            
            .btn-group {
                width: 100%;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auto-calculated {
            background-color: #e8f5e8;
            border-color: #28a745;
            font-weight: 600;
        }

        .destinazione-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header-programma">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="bi bi-calendar-check"></i> PROGRAMMA GIORNALIERO LAVORAZIONE FRUTTA</h1>
                    <h5>Sistema di Gestione Produzione - Simone Gatto</h5>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex align-items-center justify-content-end">
                        <label for="data-programma" class="form-label text-white me-2 mb-0">Data:</label>
                        <input type="date" class="form-control" id="data-programma" style="width: auto;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="section-card">
            <h4 class="section-header">
                <i class="bi bi-clipboard-data"></i> Riepilogo Giornaliero
            </h4>
            <div class="section-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <div class="input-group-custom">
                            <label for="tipo-agrume-principale" class="form-label">Tipo di Agrume Principale</label>
                            <select class="form-select" id="tipo-agrume-principale">
                                <option value="">Seleziona tipo...</option>
                                <option value="Limone">Limone</option>
                                <option value="Arancia">Arancia</option>
                                <option value="Mandarino">Mandarino</option>
                                <option value="Pompelmo">Pompelmo</option>
                                <option value="Bergamotto">Bergamotto</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group-custom">
                            <label for="giacenza-totale" class="form-label">Giacenza Iniziale (kg)</label>
                            <input type="number" class="form-control" id="giacenza-totale" placeholder="0">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group-custom">
                            <label for="entrata-totale" class="form-label">Totale in Entrata (kg)</label>
                            <input type="number" class="form-control auto-calculated" id="entrata-totale" readonly placeholder="0">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="input-group-custom">
                            <label for="totale-disponibile" class="form-label">Totale Disponibile (kg)</label>
                            <input type="number" class="form-control auto-calculated" id="totale-disponibile" readonly placeholder="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-card">
            <h4 class="section-header">
                <i class="bi bi-truck"></i> Gestione Fornitori
                <button class="btn btn-light btn-sm" id="add-fornitore">
                    <i class="bi bi-plus-circle"></i> Aggiungi Fornitore
                </button>
            </h4>
            <div class="section-body" id="fornitori-container">
            </div>
        </div>

        <div class="section-card">
            <h4 class="section-header">
                <i class="bi bi-droplet-half"></i> Rese Totali Succo 2^ e Torchiato
            </h4>
            <div class="section-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="rese-container">
                            <div class="rese-header">Succo di 2^ Spremitura - Totale</div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Resa Stimata (L)</label>
                                    <input type="number" class="form-control auto-calculated" id="totale-succo2-resa" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Destinazione</label>
                                    <select class="form-select" id="totale-succo2-destinazione">
                                        <option value="">Seleziona destinazione...</option>
                                        <option value="PET 100">PET 100</option>
                                        <option value="PET 200">PET 200</option>
                                        <option value="PET 480">PET 480</option>
                                        <option value="ACMA">ACMA</option>
                                        <option value="REX">REX</option>
                                        <option value="GOGLIO">GOGLIO</option>
                                        <option value="VASCHETTE">VASCHETTE</option>
                                        <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                        <option value="LATTE">LATTE</option>
                                        <option value="F.F.">F.F.</option>
                                        <option value="F.T.C">F.T.C</option>
                                        <option value="FBL">FBL</option>
                                        <option value="BIC">BIC</option>
                                        <option value="CISTERNA P">CISTERNA P</option>
                                        <option value="CISTERNA EF">CISTERNA EF</option>
                                        <option value="CISTERNA VK">CISTERNA VK</option>
                                        <option value="CISTERNA GS">CISTERNA GS</option>
                                        <option value="ALTRO">ALTRO</option>
                                    </select>
                                </div>
                                <div class="col-12" id="altro-succo2-container" style="display: none;">
                                    <label class="form-label">Specifica Altro</label>
                                    <input type="text" class="form-control" id="altro-succo2" placeholder="Specifica destinazione">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="rese-container">
                            <div class="rese-header">Torchiato - Totale</div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Resa Stimata (L)</label>
                                    <input type="number" class="form-control auto-calculated" id="totale-torchiato-resa" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Destinazione</label>
                                    <select class="form-select" id="totale-torchiato-destinazione">
                                        <option value="">Seleziona destinazione...</option>
                                        <option value="PET 100">PET 100</option>
                                        <option value="PET 200">PET 200</option>
                                        <option value="PET 480">PET 480</option>
                                        <option value="ACMA">ACMA</option>
                                        <option value="REX">REX</option>
                                        <option value="GOGLIO">GOGLIO</option>
                                        <option value="VASCHETTE">VASCHETTE</option>
                                        <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                        <option value="LATTE">LATTE</option>
                                        <option value="F.F.">F.F.</option>
                                        <option value="F.T.C">F.T.C</option>
                                        <option value="FBL">FBL</option>
                                        <option value="BIC">BIC</option>
                                        <option value="CISTERNA P">CISTERNA P</option>
                                        <option value="CISTERNA EF">CISTERNA EF</option>
                                        <option value="CISTERNA VK">CISTERNA VK</option>
                                        <option value="CISTERNA GS">CISTERNA GS</option>
                                        <option value="ALTRO">ALTRO</option>
                                    </select>
                                </div>
                                <div class="col-12" id="altro-torchiato-container" style="display: none;">
                                    <label class="form-label">Specifica Altro</label>
                                    <input type="text" class="form-control" id="altro-torchiato" placeholder="Specifica destinazione">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-card">
            <h4 class="section-header">
                <i class="bi bi-table"></i> Riepilogo Lavorazione Programmata
            </h4>
            <div class="section-body">
                <div class="table-responsive">
                    <table class="table table-hover summary-table" id="riepilogo-table">
                        <thead>
                            <tr>
                                <th>Fornitore</th>
                                <th>Quantità (kg)</th>
                                <th>Certificazione</th>
                                <th>Linea</th>
                                <th>Inizio</th>
                                <th>Fine</th>
                                <th>Portata (kg/h)</th>
                                <th>Succo 1^ (L)</th>
                                <th>Destinazione 1^</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12 text-center">
                <button class="btn btn-programma btn-lg me-3" id="btn-salva-programma">
                    <i class="bi bi-save"></i> Salva Programma
                </button>
                <button class="btn btn-outline-secondary btn-lg me-3" id="btn-reset-programma">
                    <i class="bi bi-arrow-clockwise"></i> Reset
                </button>
                <button class="btn btn-outline-success btn-lg" id="btn-stampa-programma">
                    <i class="bi bi-printer"></i> Stampa Programma
                </button>
            </div>
        </div>
    </div>

    <div id="fornitore-template" style="display: none;">
        <div class="fornitore-container fade-in">
            <div class="fornitore-header">
                <div>
                    <i class="bi bi-building"></i> <span class="fornitore-nome">Nuovo Fornitore</span>
                </div>
                <button class="btn btn-remove btn-sm remove-fornitore">
                    <i class="bi bi-trash"></i> Rimuovi
                </button>
            </div>
            <div class="fornitore-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Nome Fornitore</label>
                        <select class="form-select nome-fornitore">
                            <option value="">Seleziona...</option>
                            <option value="RESTUCCIA">RESTUCCIA</option>
                            <option value="CI">CI</option>
                            <option value="ARCO">ARCO</option>
                            <option value="GIOVINAZZO">GIOVINAZZO</option>
                            <option value="AZ.T.C.">AZ.T.C.</option>
                            <option value="VASTA">VASTA</option>
                            <option value="ALTRO">ALTRO</option>
                        </select>
                        <input type="text" class="form-control mt-2 altro-fornitore" style="display: none;" placeholder="Specifica altro fornitore">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Quantità (kg)</label>
                        <input type="number" class="form-control quantita-fornitore" placeholder="0">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Certificazione</label>
                        <select class="form-select certificazione-fornitore">
                            <option value="">Seleziona...</option>
                            <option value="BIO EU">BIO EU</option>
                            <option value="BIO DEM">BIO DEM</option>
                            <option value="BIO NTD">BIO NTD</option>
                            <option value="TRACCIATO">TRACCIATO</option>
                            <option value="IGP">IGP</option>
                            <option value="CONVENZIONALE">CONVENZIONALE</option>
                            <option value="ALTRO">ALTRO</option>
                        </select>
                        <input type="text" class="form-control mt-2 altra-certificazione" style="display: none;" placeholder="Specifica altra certificazione">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Linea Trasformazione</label>
                        <select class="form-select linea-trasformazione">
                            <option value="">Seleziona...</option>
                            <option value="BOE/1100">BOE/1100</option>
                            <option value="GOE INT/POLY">GOE INT/POLY</option>
                            <option value="GOE EST/POLY">GOE EST/POLY</option>
                            <option value="GOE EST/400">GOE EST/400</option>
                            <option value="B/SF">B/SF</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Portata (kg/h)</label>
                        <input type="number" class="form-control portata-impianto" placeholder="0">
                    </div>
                    <div class="col-md-1">
                        <label class="form-label">Inizio</label>
                        <input type="time" class="form-control orario-inizio">
                    </div>
                </div>
                
                <div class="row g-3 mt-2">
                    <div class="col-md-3">
                        <label class="form-label">Fine Lavorazione (Calcolata)</label>
                        <input type="time" class="form-control auto-calculated orario-fine" readonly>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Durata Lavorazione</label>
                        <input type="text" class="form-control auto-calculated durata-lavorazione" readonly placeholder="0h 0m">
                    </div>
                </div>

                <div class="rese-container">
                    <div class="rese-header">Rese Succo di 1^ Spremitura</div>
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Resa Stimata (L)</label>
                            <input type="number" class="form-control auto-calculated resa-succo1" readonly>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Destinazione</label>
                            <select class="form-select destinazione-succo1">
                                <option value="">Seleziona destinazione...</option>
                                <option value="PET 100">PET 100</option>
                                <option value="PET 200">PET 200</option>
                                <option value="PET 480">PET 480</option>
                                <option value="ACMA">ACMA</option>
                                <option value="REX">REX</option>
                                <option value="GOGLIO">GOGLIO</option>
                                <option value="VASCHETTE">VASCHETTE</option>
                                <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                <option value="LATTE">LATTE</option>
                                <option value="F.F.">F.F.</option>
                                <option value="F.T.C">F.T.C</option>
                                <option value="FBL">FBL</option>
                                <option value="BIC">BIC</option>
                                <option value="CISTERNA P">CISTERNA P</option>
                                <option value="CISTERNA EF">CISTERNA EF</option>
                                <option value="CISTERNA VK">CISTERNA VK</option>
                                <option value="CISTERNA GS">CISTERNA GS</option>
                                <option value="ALTRO">ALTRO</option>
                            </select>
                        </div>
                        <div class="col-md-6 altro-destinazione-container" style="display: none;">
                            <label class="form-label">Specifica Altra Destinazione</label>
                            <input type="text" class="form-control altra-destinazione" placeholder="Specifica destinazione">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            console.log("Inizializzazione Programma Giornaliero Lavorazione Frutta...");
            
            let fornitoreCounter = 0;
            let rese = {
                succo1: 0.65,
                succo2: 0.15,
                torchiato: 0.08
            };

            const oggi = new Date().toISOString().split('T')[0];
            $('#data-programma').val(oggi);

            $('#add-fornitore').click(function() {
                aggiungiFornitore();
            });

            function aggiungiFornitore() {
                fornitoreCounter++;
                const template = $('#fornitore-template').html();
                const newFornitore = $(template);
                
                newFornitore.find('.fornitore-nome').text('Fornitore ' + fornitoreCounter);
                $('#fornitori-container').append(newFornitore);
                aggiungiEventListenersFornitore(newFornitore);
                
                console.log('Aggiunto fornitore ' + fornitoreCounter);
            }

            function aggiungiEventListenersFornitore(fornitoreElement) {
                fornitoreElement.find('.remove-fornitore').click(function() {
                    if (confirm('Sei sicuro di voler rimuovere questo fornitore?')) {
                        fornitoreElement.remove();
                        ricalcolaTotali();
                        aggiornaRiepilogo();
                    }
                });

                fornitoreElement.find('.nome-fornitore').change(function() {
                    const altroContainer = fornitoreElement.find('.altro-fornitore');
                    if ($(this).val() === 'ALTRO') {
                        altroContainer.show();
                    } else {
                        altroContainer.hide().val('');
                        fornitoreElement.find('.fornitore-nome').text($(this).val() || 'Nuovo Fornitore');
                    }
                    aggiornaRiepilogo();
                });

                fornitoreElement.find('.altro-fornitore').on('input', function() {
                    const nomePersonalizzato = $(this).val();
                    if (nomePersonalizzato) {
                        fornitoreElement.find('.fornitore-nome').text(nomePersonalizzato);
                    }
                    aggiornaRiepilogo();
                });

                fornitoreElement.find('.certificazione-fornitore').change(function() {
                    const altraContainer = fornitoreElement.find('.altra-certificazione');
                    if ($(this).val() === 'ALTRO') {
                        altraContainer.show();
                    } else {
                        altraContainer.hide().val('');
                    }
                    
                    const isBio = $(this).val().includes('BIO');
                    if (isBio) {
                        fornitoreElement.addClass('bio-highlight');
                    } else {
                        fornitoreElement.removeClass('bio-highlight');
                    }
                    
                    aggiornaRiepilogo();
                });

                fornitoreElement.find('.destinazione-succo1').change(function() {
                    const altroContainer = fornitoreElement.find('.altro-destinazione-container');
                    if ($(this).val() === 'ALTRO') {
                        altroContainer.show();
                    } else {
                        altroContainer.hide();
                        fornitoreElement.find('.altra-destinazione').val('');
                    }
                });

                fornitoreElement.find('.quantita-fornitore, .portata-impianto, .orario-inizio').on('input change', function() {
                    calcolaLavorazione(fornitoreElement);
                    ricalcolaTotali();
                    aggiornaRiepilogo();
                });
            }

            function calcolaLavorazione(fornitoreElement) {
                const quantita = parseFloat(fornitoreElement.find('.quantita-fornitore').val()) || 0;
                const portata = parseFloat(fornitoreElement.find('.portata-impianto').val()) || 0;
                const orarioInizio = fornitoreElement.find('.orario-inizio').val();

                if (quantita > 0 && portata > 0 && orarioInizio) {
                    const durataOre = quantita / portata;
                    const ore = Math.floor(durataOre);
                    const minuti = Math.round((durataOre - ore) * 60);
                    
                    fornitoreElement.find('.durata-lavorazione').val(ore + 'h ' + minuti + 'm');
                    
                    const parts = orarioInizio.split(':').map(Number);
                    const oreInizio = parts[0];
                    const minutiInizio = parts[1];
                    const inizioMinuti = oreInizio * 60 + minutiInizio;
                    const fineMinuti = inizioMinuti + (ore * 60) + minuti;
                    const oreFine = Math.floor(fineMinuti / 60) % 24;
                    const minutiFine = fineMinuti % 60;
                    
                    const orarioFine = oreFine.toString().padStart(2, '0') + ':' + minutiFine.toString().padStart(2, '0');
                    fornitoreElement.find('.orario-fine').val(orarioFine);
                    
                    const resaSucco1 = Math.round(quantita * rese.succo1);
                    fornitoreElement.find('.resa-succo1').val(resaSucco1);
                    
                } else {
                    fornitoreElement.find('.durata-lavorazione').val('');
                    fornitoreElement.find('.orario-fine').val('');
                    fornitoreElement.find('.resa-succo1').val('');
                }
            }

            function ricalcolaTotali() {
                let totaleEntrata = 0;
                let totaleSucco2 = 0;
                let totaleTorchiato = 0;
                
                $('.quantita-fornitore').each(function() {
                    const quantita = parseFloat($(this).val()) || 0;
                    totaleEntrata += quantita;
                    totaleSucco2 += quantita * rese.succo2;
                    totaleTorchiato += quantita * rese.torchiato;
                });
                
                $('#entrata-totale').val(totaleEntrata);
                
                const giacenza = parseFloat($('#giacenza-totale').val()) || 0;
                $('#totale-disponibile').val(giacenza + totaleEntrata);
                
                $('#totale-succo2-resa').val(Math.round(totaleSucco2));
                $('#totale-torchiato-resa').val(Math.round(totaleTorchiato));
           }

           $('#totale-succo2-destinazione').change(function() {
               if ($(this).val() === 'ALTRO') {
                   $('#altro-succo2-container').show();
               } else {
                   $('#altro-succo2-container').hide();
                   $('#altro-succo2').val('');
               }
           });

           $('#totale-torchiato-destinazione').change(function() {
               if ($(this).val() === 'ALTRO') {
                   $('#altro-torchiato-container').show();
               } else {
                   $('#altro-torchiato-container').hide();
                   $('#altro-torchiato').val('');
               }
           });

           function aggiornaRiepilogo() {
               const tbody = $('#riepilogo-table tbody');
               tbody.empty();
               
               $('.fornitore-container').each(function() {
                   const fornitoreElement = $(this);
                   const nomeFornitore = fornitoreElement.find('.nome-fornitore').val() === 'ALTRO' 
                       ? fornitoreElement.find('.altro-fornitore').val() 
                       : fornitoreElement.find('.nome-fornitore').val();
                   
                   const quantita = fornitoreElement.find('.quantita-fornitore').val();
                   const certificazione = fornitoreElement.find('.certificazione-fornitore').val() === 'ALTRO'
                       ? fornitoreElement.find('.altra-certificazione').val()
                       : fornitoreElement.find('.certificazione-fornitore').val();
                   
                   const linea = fornitoreElement.find('.linea-trasformazione').val();
                   const inizio = fornitoreElement.find('.orario-inizio').val();
                   const fine = fornitoreElement.find('.orario-fine').val();
                   const portata = fornitoreElement.find('.portata-impianto').val();
                   const succo1 = fornitoreElement.find('.resa-succo1').val();
                   const destinazione1 = fornitoreElement.find('.destinazione-succo1').val() === 'ALTRO'
                       ? fornitoreElement.find('.altra-destinazione').val()
                       : fornitoreElement.find('.destinazione-succo1').val();
                   
                   if (nomeFornitore && quantita) {
                       const isBio = certificazione && certificazione.includes('BIO');
                       const rowClass = isBio ? 'bio-text' : '';
                       
                       const row = '<tr class="' + rowClass + '">' +
                           '<td>' + (nomeFornitore || '-') + '</td>' +
                           '<td>' + (quantita || '-') + ' kg</td>' +
                           '<td>' + (certificazione || '-') + '</td>' +
                           '<td>' + (linea || '-') + '</td>' +
                           '<td>' + (inizio || '-') + '</td>' +
                           '<td>' + (fine || '-') + '</td>' +
                           '<td>' + (portata || '-') + ' kg/h</td>' +
                           '<td>' + (succo1 || '-') + ' L</td>' +
                           '<td>' + (destinazione1 || '-') + '</td>' +
                           '</tr>';
                       tbody.append(row);
                   }
               });
           }

           $('#giacenza-totale').on('input', function() {
               ricalcolaTotali();
           });

           $('#btn-salva-programma').click(function() {
               const programma = raccogliDatiProgramma();
               if (validaProgramma(programma)) {
                   const dataProgram = $('#data-programma').val();
                   const timestamp = new Date().toLocaleString();
                   
                   alert('Programma salvato con successo!\n\nData: ' + dataProgram + '\nTimestamp: ' + timestamp + '\nFornitori: ' + programma.fornitori.length + '\nTotale frutta: ' + programma.totaleEntrata + ' kg');
                   
                   console.log('Programma salvato:', programma);
               } else {
                   alert('Completare tutti i campi obbligatori prima di salvare il programma.');
               }
           });

           $('#btn-reset-programma').click(function() {
               if (confirm('Attenzione: tutti i dati inseriti verranno cancellati. Continuare?')) {
                   resetProgramma();
               }
           });

           $('#btn-stampa-programma').click(function() {
               stampaPrograma();
           });

           function raccogliDatiProgramma() {
               const programma = {
                   data: $('#data-programma').val(),
                   tipoAgrumePrincipale: $('#tipo-agrume-principale').val(),
                   giacenzaIniziale: parseFloat($('#giacenza-totale').val()) || 0,
                   totaleEntrata: parseFloat($('#entrata-totale').val()) || 0,
                   totaleDisponibile: parseFloat($('#totale-disponibile').val()) || 0,
                   fornitori: [],
                   reseTotali: {
                       succo2: {
                           resa: $('#totale-succo2-resa').val(),
                           destinazione: $('#totale-succo2-destinazione').val() === 'ALTRO' 
                               ? $('#altro-succo2').val() 
                               : $('#totale-succo2-destinazione').val()
                       },
                       torchiato: {
                           resa: $('#totale-torchiato-resa').val(),
                           destinazione: $('#totale-torchiato-destinazione').val() === 'ALTRO'
                               ? $('#altro-torchiato').val()
                               : $('#totale-torchiato-destinazione').val()
                       }
                   }
               };
               
               $('.fornitore-container').each(function() {
                   const fornitore = {
                       nome: $(this).find('.nome-fornitore').val() === 'ALTRO' 
                           ? $(this).find('.altro-fornitore').val() 
                           : $(this).find('.nome-fornitore').val(),
                       quantita: parseFloat($(this).find('.quantita-fornitore').val()) || 0,
                       certificazione: $(this).find('.certificazione-fornitore').val() === 'ALTRO'
                           ? $(this).find('.altra-certificazione').val()
                           : $(this).find('.certificazione-fornitore').val(),
                       linea: $(this).find('.linea-trasformazione').val(),
                       portata: parseFloat($(this).find('.portata-impianto').val()) || 0,
                       orarioInizio: $(this).find('.orario-inizio').val(),
                       orarioFine: $(this).find('.orario-fine').val(),
                       durata: $(this).find('.durata-lavorazione').val(),
                       resaSucco1: $(this).find('.resa-succo1').val(),
                       destinazioneSucco1: $(this).find('.destinazione-succo1').val() === 'ALTRO'
                           ? $(this).find('.altra-destinazione').val()
                           : $(this).find('.destinazione-succo1').val()
                   };
                   
                   if (fornitore.nome && fornitore.quantita > 0) {
                       programma.fornitori.push(fornitore);
                   }
               });
               
               return programma;
           }

           function validaProgramma(programma) {
               if (!programma.data || !programma.tipoAgrumePrincipale) {
                   return false;
               }
               
               if (programma.fornitori.length === 0) {
                   return false;
               }
               
               for (let i = 0; i < programma.fornitori.length; i++) {
                   const fornitore = programma.fornitori[i];
                   if (!fornitore.nome || !fornitore.quantita || !fornitore.certificazione || 
                       !fornitore.linea || !fornitore.portata || !fornitore.orarioInizio) {
                       return false;
                   }
               }
               
               return true;
           }

           function resetProgramma() {
               $('#tipo-agrume-principale').val('');
               $('#giacenza-totale').val('');
               $('#entrata-totale').val('');
               $('#totale-disponibile').val('');
               
               $('#totale-succo2-resa').val('');
               $('#totale-succo2-destinazione').val('');
               $('#altro-succo2').val('');
               $('#altro-succo2-container').hide();
               
               $('#totale-torchiato-resa').val('');
               $('#totale-torchiato-destinazione').val('');
               $('#altro-torchiato').val('');
               $('#altro-torchiato-container').hide();
               
               $('#fornitori-container').empty();
               $('#riepilogo-table tbody').empty();
               
               fornitoreCounter = 0;
               
               console.log('Programma resetato');
           }

           function stampaPrograma() {
               const programma = raccogliDatiProgramma();
               
               const finestra = window.open('', '_blank');
               finestra.document.write('<!DOCTYPE html>' +
                   '<html>' +
                   '<head>' +
                       '<title>Programma Giornaliero Lavorazione - ' + programma.data + '</title>' +
                       '<style>' +
                           'body { font-family: Arial, sans-serif; margin: 20px; }' +
                           '.header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }' +
                           '.section { margin-bottom: 25px; }' +
                           '.section h3 { background-color: #f5f5f5; padding: 10px; margin: 0 0 15px 0; }' +
                           'table { width: 100%; border-collapse: collapse; margin-top: 10px; }' +
                           'th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }' +
                           'th { background-color: #f5f5f5; font-weight: bold; }' +
                           '.bio { color: #dc3545; font-weight: bold; }' +
                           '.totali { background-color: #e8f5e8; }' +
                           '@media print { .no-print { display: none; } }' +
                       '</style>' +
                   '</head>' +
                   '<body>' +
                       '<div class="header">' +
                           '<h1>PROGRAMMA GIORNALIERO LAVORAZIONE FRUTTA</h1>' +
                           '<h2>Simone Gatto - Produzione Agrumi</h2>' +
                           '<p><strong>Data: ' + programma.data + '</strong></p>' +
                           '<p><strong>Tipo Agrume Principale: ' + programma.tipoAgrumePrincipale + '</strong></p>' +
                       '</div>' +
                       
                       '<div class="section">' +
                           '<h3>Riepilogo Quantità</h3>' +
                           '<table>' +
                               '<tr>' +
                                   '<td><strong>Giacenza Iniziale:</strong></td>' +
                                   '<td>' + programma.giacenzaIniziale + ' kg</td>' +
                                   '<td><strong>Totale in Entrata:</strong></td>' +
                                   '<td>' + programma.totaleEntrata + ' kg</td>' +
                                   '<td><strong>Totale Disponibile:</strong></td>' +
                                   '<td class="totali">' + programma.totaleDisponibile + ' kg</td>' +
                               '</tr>' +
                           '</table>' +
                       '</div>' +
                       
                       '<div class="section">' +
                           '<h3>Dettaglio Fornitori e Lavorazione</h3>' +
                           '<table>' +
                               '<thead>' +
                                   '<tr>' +
                                       '<th>Fornitore</th>' +
                                       '<th>Quantità (kg)</th>' +
                                       '<th>Certificazione</th>' +
                                       '<th>Linea</th>' +
                                       '<th>Inizio</th>' +
                                       '<th>Fine</th>' +
                                       '<th>Portata (kg/h)</th>' +
                                       '<th>Succo 1^ (L)</th>' +
                                       '<th>Destinazione 1^</th>' +
                                   '</tr>' +
                               '</thead>' +
                               '<tbody>' +
                                   programma.fornitori.map(function(f) {
                                       return '<tr class="' + (f.certificazione && f.certificazione.includes('BIO') ? 'bio' : '') + '">' +
                                           '<td>' + f.nome + '</td>' +
                                           '<td>' + f.quantita + '</td>' +
                                           '<td>' + f.certificazione + '</td>' +
                                           '<td>' + f.linea + '</td>' +
                                           '<td>' + f.orarioInizio + '</td>' +
                                           '<td>' + f.orarioFine + '</td>' +
                                           '<td>' + f.portata + '</td>' +
                                           '<td>' + f.resaSucco1 + '</td>' +
                                           '<td>' + f.destinazioneSucco1 + '</td>' +
                                       '</tr>';
                                   }).join('') +
                               '</tbody>' +
                           '</table>' +
                       '</div>' +
                       
                       '<div class="section">' +
                           '<h3>Rese Totali Succo 2^ e Torchiato</h3>' +
                           '<table>' +
                               '<tr>' +
                                   '<td><strong>Succo 2^ Spremitura:</strong></td>' +
                                   '<td>' + programma.reseTotali.succo2.resa + ' L</td>' +
                                   '<td><strong>Destinazione:</strong></td>' +
                                   '<td>' + programma.reseTotali.succo2.destinazione + '</td>' +
                               '</tr>' +
                               '<tr>' +
                                   '<td><strong>Torchiato:</strong></td>' +
                                   '<td>' + programma.reseTotali.torchiato.resa + ' L</td>' +
                                   '<td><strong>Destinazione:</strong></td>' +
                                   '<td>' + programma.reseTotali.torchiato.destinazione + '</td>' +
                               '</tr>' +
                           '</table>' +
                       '</div>' +
                       
                       '<div class="section" style="margin-top: 50px;">' +
                           '<p><strong>Stampato il:</strong> ' + new Date().toLocaleString() + '</p>' +
                           '<p><strong>Firma Responsabile:</strong> _____________________</p>' +
                       '</div>' +
                       
                       '<script>' +
                           'window.onload = function() {' +
                               'window.print();' +
                               'window.onafterprint = function() {' +
                                   'window.close();' +
                               '}' +
                           '}' +
                       '</script>' +
                   '</body>' +
                   '</html>');
               finestra.document.close();
           }

           function caricaDatiEsempio() {
               console.log("Caricamento dati di esempio...");
               
               $('#tipo-agrume-principale').val('Arancia');
               $('#giacenza-totale').val('15000');
               
               aggiungiFornitore();
               const primoFornitore = $('.fornitore-container').last();
               primoFornitore.find('.nome-fornitore').val('RESTUCCIA').trigger('change');
               primoFornitore.find('.quantita-fornitore').val('8000').trigger('input');
               primoFornitore.find('.certificazione-fornitore').val('BIO EU').trigger('change');
               primoFornitore.find('.linea-trasformazione').val('BOE/1100');
               primoFornitore.find('.portata-impianto').val('2500').trigger('input');
               primoFornitore.find('.orario-inizio').val('08:00').trigger('change');
               primoFornitore.find('.destinazione-succo1').val('CISTERNA P');
               
               aggiungiFornitore();
               const secondoFornitore = $('.fornitore-container').last();
               secondoFornitore.find('.nome-fornitore').val('CI').trigger('change');
               secondoFornitore.find('.quantita-fornitore').val('6000').trigger('input');
               secondoFornitore.find('.certificazione-fornitore').val('CONVENZIONALE').trigger('change');
               secondoFornitore.find('.linea-trasformazione').val('GOE INT/POLY');
               secondoFornitore.find('.portata-impianto').val('2000').trigger('input');
               secondoFornitore.find('.orario-inizio').val('11:15').trigger('change');
               secondoFornitore.find('.destinazione-succo1').val('PET 200');
               
               $('#totale-succo2-destinazione').val('CISTERNA VK');
               $('#totale-torchiato-destinazione').val('F.T.C');
               
               console.log("Dati di esempio caricati");
           }

           setTimeout(caricaDatiEsempio, 500);

           console.log("Inizializzazione completata - Programma Giornaliero pronto all'uso");
       });
   </script>
</body>
</html>
